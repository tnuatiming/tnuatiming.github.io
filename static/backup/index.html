<!DOCTYPE html>
<html class="no-js" lang="he" xml:lang="he" dir="ltr">

<head>

    <title>תנועה מדידת זמנים  &ndash; live timing</title>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="fksQzLHsNNdUr7KUw53_2thUPno2gvM0oe_MRxWvjSo">
    <meta name="description" content="תנועה מדידת זמנים עוסקת במדידת זמנים בארועי ספורט">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/favicon-194x194.png" sizes="194x194">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffcc33">
    <meta name="apple-mobile-web-app-title" content="תנועה מדדית זמנים">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="application-name" content="תנועה מדדית זמנים">
    <meta name="msapplication-TileColor" content="#ffcc33">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffcc33">
    
    <link rel="stylesheet" media="all" type="text/css" href="/style/global.css">

    <meta property="og:locale" content="he_IL">
    <meta property="og:site_name" content="tnua timing - תנועה מדידת זמנים">
    <meta property="og:title" content="תנועה מדידת זמנים  &ndash; live timing">
    <meta property="og:description" content="live timing">
    
    <meta property="og:url" content="https://tnuatiming.com/">
    <meta property="og:image" content="http://tnuatiming.com/images/logo2_og.png">
    <meta property="og:image:type" content="image/png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">

    <style>
        html {
            background: #f0f0f0;
            height: 100%;
            width: 100%;
            font-size: 16px;
            direction: ltr;
        }
        body {
        background-image: none;
        }
        div#gr.btn {
            display: block;
            margin: 0;
            background: gray;
        }
        #buttonInfo, #ok {
            font-size: 2em;
            flex-direction: column;
            direction: ltr;
            color: white;
        }
        button#cc, button#dd, button#ee {
            font-size: 1.5em;
            vertical-align: middle;
            margin: 25px;
            padding: 10px;
            color: white;
            background-color: red;
            border: none;
            cursor: pointer;
        }
        button#ee {
            background-color: gray;
        }
        button {
            cursor: pointer;
        }
        button#x {
            color: red;
            font-size: 1.5em;
            flex-shrink: 12;
            padding: 0 10px;

        }
        .liveItem {
            display: flex;
            flex-direction: row;
            width: 80%;
        }
        button.liveLine {
            width: 80%;
            text-align: left;
            padding: 10px;
        }
        div#result, div#logx {
            text-align: left;
            margin: 40px 20%;
        }
        #resultx, #options {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: flex-start;
            margin-left: 20%;
        }
        #resultz {
            margin-top: 20px;
        }
        div#resultx div {
            width: 100%;
        }
        #bt1, #bt2 {
            display: none;
        }
        div#resultx button {
            margin-top: 6px;
            background: #ccc;
            border: none;
            display: block;
        }
        h1#Title img {
            border: 0;
            max-width: 32px;
            height: auto;
            margin: 0 10px;
        }
        li {
            text-align: left;
            }

    </style>

    


</head>

<body id="backup">

    <div id="ok">
        <div id="gr" class="btn">&nbsp;</div>
    <!--        <button id="clear" class="btn" onclick="clear()">clear all</button>-->
    </div>    
    
    <div id="options">
        <label for="no_header"><input type="checkbox" id="no_header" name="no_header" value="no_header">&nbsp;do not check header for time and name change (reduce saved files) *</label>
        <label for="no_download"><input type="checkbox" id="no_download" name="no_download" value="no_download">&nbsp;do not download live files</label>
        <label for="inBrowser"><input type="checkbox" id="inBrowser" name="inBrowser" value="inBrowser">&nbsp;save in browser</label>
        <label for="fullLog"><input type="checkbox" id="fullLog" name="fullLog" value="fullLog">&nbsp;show full log</label>
    </div>

    <div id="result"></div>
<div id="logx"></div>

<!-- test web   -->                 
<div id="bt">
<button id="cc">delete log</button>
</div>
<div id="resultx"></div>
<div id="resultz"></div>
<div id="bt2">
<button id="ee" title="">download live as file</button>
</div>
<div id="bt1">
<button id="dd" title="delete all entries saved in the browser">delete in browser</button>
</div>
</body>

<script>

    var TimerLoad;
    var Rafraichir = 10000;// 10 sec

    var url = "/live/p1.html";
    var target = "result";
    var P1;
    var tmp;
    var nameforshownlive;
    var no_header = 1;
    if (localStorage.getItem("no_header")) {
        no_header = localStorage.getItem("no_header");
    }
    if (no_header == 1) {
        document.getElementById("no_header").checked = true;
    } else {
        document.getElementById("no_header").checked = false;
    }
    var no_download = 1; // do not auto download the p1 files
    if (localStorage.getItem("no_download")) {
        no_download = localStorage.getItem("no_download");
    }
    if (no_download == 1) {
        document.getElementById("no_download").checked = true;
    } else {
        document.getElementById("no_download").checked = false;
    }
    var nh = "  ";

    var old_live = "";
    if (sessionStorage.getItem("old_live")) {
        old_live = sessionStorage.getItem("old_live");
    }

    var log = "";
    if (localStorage.getItem("log")) {
        log = localStorage.getItem("log");
    }
// log as array
var logx = [];
if (localStorage.getItem("logx")) {
    logx = JSON.parse(localStorage.getItem("logx"));
}

// test web
var old_resultx = "";
if (localStorage.getItem("old_resultx")) {
    old_resultx = localStorage.getItem("old_resultx");
}

var files = {};
if (localStorage.getItem("files")) {
    files = JSON.parse(localStorage.getItem("files"));
}
var inBrowser = 1; // save p1 in the browser
if (localStorage.getItem("inBrowser")) {
    inBrowser = localStorage.getItem("inBrowser");
}
if (inBrowser == 1) {
    document.getElementById("inBrowser").checked = true;
    document.getElementById("bt1").style.display = "block";
    document.getElementById("resultx").innerHTML = old_resultx;
} else {
    document.getElementById("inBrowser").checked = false;
}

// full log
document.getElementById(target).style.display = "none"; // hiding log as we are showing logx

    document.addEventListener("DOMContentLoaded", function() {

        document.getElementById("cc").addEventListener("click", clear);
// test web
document.getElementById("dd").addEventListener("click", clearWeb);
document.getElementById("ee").addEventListener("click", downloadlive);
document.getElementById("inBrowser").addEventListener("change", event => {
    if (event.target.checked) {
        inBrowser = 1;
        localStorage.setItem("inBrowser", inBrowser);
        document.getElementById("bt1").style.display = "block";
        document.getElementById("resultx").innerHTML = old_resultx;
        document.getElementById("resultx").style.display = "block";
//        Load(url, target);
    } else {
        inBrowser = 0;
        localStorage.setItem("inBrowser", inBrowser);
        document.getElementById("bt1").style.display = "none";
        document.getElementById("bt2").style.display = "none";
        document.getElementById('ee').setAttribute('title', "");
        document.getElementById("resultx").style.display = "none";
        document.getElementById("resultz").style.display = "none";
//        Load(url, target);
    }
});


        document.getElementById("no_header").addEventListener("change", event => {
            if (event.target.checked) {
                no_header = 1;
                nh = " *";
                localStorage.setItem("no_header", no_header);
                Load(url, target);
            } else {
                no_header = 0;
                nh = "  ";
                localStorage.setItem("no_header", no_header);
                Load(url, target);
            }
        });


        document.getElementById("no_download").addEventListener("change", event => {
            if (event.target.checked) {
                no_download = 1;
                localStorage.setItem("no_download", no_download);
            } else {
                no_download = 0;
                localStorage.setItem("no_download", no_download);
            }
        });

// full log
document.getElementById("fullLog").addEventListener("change", event => {
    if (event.target.checked) {
        document.getElementById("logx").style.display = "none";
        document.getElementById("result").style.display = "block";
    } else {
        document.getElementById("logx").style.display = "block";
        document.getElementById("result").style.display = "none";
    }
});        
        
        Load(url, target);

    });
    
    async function Load(url, target) {

            var loop;
            if (TimerLoad) clearTimeout(TimerLoad);

/*            var rightNow = new Date();
            var da = rightNow.toJSON().slice(0,10).replace(/-/g,"");
            var tm = rightNow.toJSON().slice(11,19).replace(/:/g,"");
        console.log(da)
        console.log(tm)*/
            var ma = new Date();
            var dateString = ma.getUTCFullYear() + ("0" + (ma.getUTCMonth()+1)).slice(-2) + ("0" + ma.getUTCDate()).slice(-2) + "_" + ("0" + (ma.getUTCHours()+2)).slice(-2) + ":" + ("0" + ma.getUTCMinutes()).slice(-2) + ":" + ("0" + ma.getUTCSeconds()).slice(-2);
//        console.log(dateString)

        if (self.fetch) {

            try {
                const response = await fetch(url, {cache: "no-store"});
                if (response.ok) {
                    document.getElementById("gr").style.backgroundColor = "green"; 
                    document.getElementById("gr").style.color = "white"; 
                    P1 = await response.text();
 //                   document.getElementById(target).innerHTML = 'p1_' + dateString + '.html';

                    tmp = P1;

                    if (no_header == 1) {
//                        tmp = tmp.split('<table', 2); // split the text to title/time and the table
                        tmp = tmp.split("\r\n\r\n", 2); // split the text to title/time and the table
                        tmp = tmp[1];

                    } else {

                    }

//         console.log(tmp)
 
                    if (old_live != tmp) {
                        var Text = P1.split('.png">', 2);
                        Text = Text[1].split("<img", 2);
                        var rt = P1.split('RemainingTime">', 2);
                        rt = rt[1].split("</span>", 2);
                        if (no_download == 0) {
                            download(P1, dateString.replace(/:/g,"") + "_p1_" + Text[0] + "_" + rt[0] + ".html", "text/plain");        
                        }
                        log += "<div>" + dateString + " " + Text[0]  + " " + rt[0] + nh + "</div>\n";
// log as array
logx.push(dateString + " " + Text[0]  + " " + rt[0] + nh);
//        console.log(logx);

// test web
if (inBrowser == 1) {

files[dateString] = P1;
localStorage.setItem("files", JSON.stringify(files));

var nn = dateString + " " + Text[0]  + " " + rt[0] + nh;


var vvv = document.createElement("div");
vvv.setAttribute("id", dateString);
vvv.setAttribute("class", "liveItem");
document.getElementById("resultx").append(vvv);                        


var btn = document.createElement("button");
btn.innerHTML = nn;
btn.setAttribute("onclick", "publish('" + dateString + "', '" + Text[0]  + " " + rt[0] + "')");
//btn.setAttribute("id", dateString);
btn.setAttribute("class", "liveLine");
document.getElementById(dateString).append(btn);                        

var btnx = document.createElement("button");// delete entery button
btnx.innerHTML = "X";
btnx.setAttribute("onclick", "delLine('" + dateString + "')");
btnx.setAttribute("id", "x");
btnx.setAttribute('title', "permanently delete the entery");
document.getElementById(dateString).append(btnx);                        

old_resultx = document.getElementById("resultx").innerHTML;
localStorage.setItem("old_resultx", old_resultx);  

} else {

}

                        old_live = tmp;
                        sessionStorage.setItem("old_live", old_live);  
                    
                    } else {
 
                        log += "<div>" + dateString + " no update</div>\n";
                        
// log as array
if (!logx.length) { // logx empty
logx.push(dateString + " no update");
//        console.log(logx);
        
} else {

const lastItem = logx[logx.length - 1]

if (lastItem.includes("no update")) { // replace with current time
logx.pop();
logx.push(dateString + " no update");

} else {
logx.push(dateString + " no update");

}
}                        
                        
                    }
                    
                } else {
                    console.log(response.status);
                    document.getElementById("gr").style.backgroundColor = "yellow"; 
                    document.getElementById("gr").style.color = "#222"; 
                    log += "<div>" + dateString + " server returned status: " + response.status + "</div>\n";
// log as array
if (!logx.length) { // logx empty
logx.push(dateString + " server returned status: " + response.status);
//        console.log(logx);
        
} else {

const lastItem = logx[logx.length - 1]

if (lastItem.includes("server returned status") && lastItem.includes(response.status)) { // replace with current time
logx.pop();
logx.push(dateString + " server returned status: " + response.status);

} else {
logx.push(dateString + " server returned status: " + response.status);

}
}

                    }
            }
            catch (err) {
                console.log("results fetch failed", err);
                document.getElementById("gr").style.backgroundColor = "red"; 
                document.getElementById("gr").style.color = "white"; 
                log += "<div>" + dateString + " something wrong :(</div>\n";

// log as array
if (!logx.length) { // logx empty
logx.push(dateString + " something wrong :(");
//        console.log(logx);
    
} else {

const lastItem = logx[logx.length - 1]

if (lastItem.includes("something wrong")) { // replace with current time
logx.pop();
logx.push(dateString + " something wrong :(");

} else {
logx.push(dateString + " something wrong :(");

}
}

//        console.log(logx);
            }

        } 
                
        document.getElementById(target).innerHTML = log;
//document.getElementById(target).style.display = "none"; // hiding log as we are showing logx

        localStorage.setItem("log", log);  

// log as array
var logxInnerHTML = "";
if (logx.length > 0) {
    logxInnerHTML += "<ul>";
    for (var ii = 0; ii < logx.length; ii++) {
        logxInnerHTML += '<li>' + logx[ii] + '</li>';
    }
    logxInnerHTML += "</ul>";

    document.getElementById("logx").innerHTML = logxInnerHTML;
} else {
    document.getElementById("logx").innerHTML = "&nbsp;";
}

localStorage.setItem("logx", JSON.stringify(logx));
//        console.log(logx);

        loop = function() {
            Load(url, target);
        };

// countdown
document.getElementById("gr").innerHTML = Rafraichir/1000;

        TimerLoad = setTimeout(loop, Rafraichir);
        Rafraichir = 60000;

    }

    function download(content, fileName, contentType) {
        var a = document.createElement("a");
        a.setAttribute("id", "download");
        var file = new Blob([content], {type: contentType});
        a.href = URL.createObjectURL(file);
        a.download = fileName.replace(/:/g,"_").replace(/-/g,"_").replace(/ /g,"_").replace(/_+/g,"_");
        a.click();
    }
    function downloadlive() {
        var a = document.createElement("a");
        a.setAttribute("id", "download");
        var file = new Blob([document.getElementById("resultz").innerHTML], {type: "text/plain"});
        a.href = URL.createObjectURL(file);
        a.download = nameforshownlive.replace(/_+/g,"_");
        a.click();
    }

    function clear() {
        if (confirm("you about to delete the log!, are you sure?")) {

            log = "";
            logx = [];
            old_live = "";
            document.getElementById(target).innerHTML = "";
            document.getElementById("logx").innerHTML = "";
            localStorage.removeItem("log");  
            localStorage.removeItem("logx");  
            sessionStorage.removeItem("old_live");
        }
    }

// test web                    
function clearWeb() {
  if (confirm("you about to delete the saved live data!, are you sure?")) {
    document.getElementById("resultx").innerHTML = "";
    document.getElementById("resultz").innerHTML = "";
    localStorage.removeItem("files"); 
    files = {};
    localStorage.removeItem("old_resultx");  
    document.getElementById("bt2").style.display = "none";
    document.getElementById('ee').setAttribute('title', "");
  }
}

function publish(x, y) {
    document.getElementById("resultz").innerHTML = files[x];
    document.getElementById("bt2").style.display = "block";
    nameforshownlive = (x + "_" + y).replace(/:/g,"_").replace(/-/g,"_").replace(/ /g,"_").replace(/_+/g,"_");
    document.getElementById('ee').setAttribute('title', nameforshownlive + ".txt");
}

function delLine(z) {
    delete files[z];
    localStorage.setItem("files", JSON.stringify(files));
    document.getElementById(z).remove();
}


// countdown
const timer = () =>{
var x = document.getElementById("gr").innerHTML;
if (x > 0) {
    x -= 1;
} else {
    x = 0;
}
document.getElementById("gr").innerHTML = x;
};
// countdown
timer();
// Calling the function every 1000 milliseconds.
setInterval(timer,1000);


</script>

</html>
 
