<!DOCTYPE html>
<html class="no-js" lang="he" xml:lang="he" dir="ltr">

<head>

    <title>תנועה מדידת זמנים  &ndash; live timing</title>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="fksQzLHsNNdUr7KUw53_2thUPno2gvM0oe_MRxWvjSo">
    <meta name="description" content="תנועה מדידת זמנים עוסקת במדידת זמנים בארועי ספורט">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/favicon-194x194.png" sizes="194x194">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffcc33">
    <meta name="apple-mobile-web-app-title" content="תנועה מדדית זמנים">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="application-name" content="תנועה מדדית זמנים">
    <meta name="msapplication-TileColor" content="#ffcc33">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffcc33">
    
    <link rel="stylesheet" media="all" type="text/css" href="/style/global.css">

    <meta property="og:locale" content="he_IL">
    <meta property="og:site_name" content="tnua timing - תנועה מדידת זמנים">
    <meta property="og:title" content="תנועה מדידת זמנים  &ndash; live timing">
    <meta property="og:description" content="live timing">
    
    
    <meta property="og:url" content="https://tnuatiming.com/">
    <meta property="og:image" content="http://tnuatiming.com/images/logo2_og.png">
    <meta property="og:image:type" content="image/png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">


    <style>
        html {
            background: #f0f0f0;
            height: 100%;
            width: 100%;
            font-size: 16px;
            direction: ltr;
        }
        
        body {background-image: none;}

        div#gr.btn {
            display: block;
            margin: 0;
            background: gray;
        }
        
        #buttonInfo, #ok {
            font-size: 2em;
            flex-direction: column;
            direction: ltr;
            color: white;
        }

        button#cc, button#dd {
            font-size: 2em;
            vertical-align: middle;
            margin: 25px;
            padding: 10px;
            color: white;
            background-color: gray;
            border: none;
        }

        div#result {
            text-align: left;
            margin: 40px 20%;
        }
        #sec {
            text-align: right;
        }

        #resultx, #options {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: flex-start;
            margin-left: 20%;
}
        }
        #resultz {
            margin-top: 20px;
        }
        #bt1 {
            display: none;
        }
        div#resultx button {
            margin-top: 6px;
            background: #ccc;
            padding: 5px 0;
            border: none;
            display: block;
            width: 60%;
        }

    </style>

    


</head>

<body id="backup">

    <div id="ok">
        <div id="gr" class="btn">&nbsp;</div>
    <!--        <button id="clear" class="btn" onclick="clear()">clear all</button>-->
    </div>    
    <div id="sec">0</div>
    
    <div id="options">
        <label for="no_header"><input type="checkbox" id="no_header" name="no_header" value="no_header">&nbsp;do not check header (reduce saved files) *</label>
        <label for="no_download"><input type="checkbox" id="no_download" name="no_download" value="no_download">&nbsp;do not download files</label>
        <label for="no_web"><input type="checkbox" id="no_web" name="no_web" value="no_web">&nbsp;save on web</label>
    </div>

    <div id="result"></div>

<!-- test web   -->                 
<div id="bt">
<button id="cc">clear log</button>
</div>
<div id="resultx"></div>
<div id="resultz"></div>
<div id="bt1">
<button id="dd">clear web</button>
</div>

</body>

<script>

    var TimerLoad;
    var Rafraichir = 10000;

    var url = '/live/p1.html';
    var target = 'result';
    var P1;
    var tmp;
    var no_header = 0;
    var no_download = 0;
    var nh = "  ";
    
    var old_live = "";
    if (sessionStorage.getItem('old_live')) {
        old_live = sessionStorage.getItem('old_live');
    }      

    var log = "";    
    if (localStorage.getItem('log')) {
        log = localStorage.getItem('log');
    }      

// test web                    
var files = {};    
if (localStorage.getItem('files')) {
    files = JSON.parse(localStorage.getItem('files'));
}
var no_web = 0;
var old_resultx = "";
if (localStorage.getItem('old_resultx')) {
    old_resultx = localStorage.getItem('old_resultx');
}      

    document.addEventListener("DOMContentLoaded", function() {
    
        document.getElementById("cc").addEventListener("click", clear);
// test web                    
document.getElementById("dd").addEventListener("click", clearWeb);
document.getElementById('no_web').addEventListener('change', event => {
    if (event.target.checked) {
        no_web = 1;
document.getElementById("bt1").style.display = "block";        
document.getElementById("resultx").innerHTML = old_resultx;
//        Load(url, target);
    } else {
        no_web = 0;
document.getElementById("bt1").style.display = "none";        
//        Load(url, target);
    }
});


        document.getElementById('no_header').addEventListener('change', event => {
            if (event.target.checked) {
                no_header = 1;
                nh = " *";
                Load(url, target);
            } else {
                no_header = 0;
                nh = "  ";
                Load(url, target);
            }
        });


        document.getElementById('no_download').addEventListener('change', event => {
            if (event.target.checked) {
                no_download = 1;
            } else {
                no_download = 0;
            }
        });
                
        Load(url, target);

    });
    
    async function Load(url, target) {
        
            var loop;
            if (TimerLoad) clearTimeout(TimerLoad);

/*            var rightNow = new Date();
            var da = rightNow.toJSON().slice(0,10).replace(/-/g,"");
            var tm = rightNow.toJSON().slice(11,19).replace(/:/g,"");
        console.log(da)
        console.log(tm)*/
            var ma = new Date();
            var dateString = ma.getUTCFullYear() + ("0" + (ma.getUTCMonth()+1)).slice(-2) + ("0" + ma.getUTCDate()).slice(-2) + "_" + ("0" + (ma.getUTCHours()+2)).slice(-2) + ":" + ("0" + ma.getUTCMinutes()).slice(-2) + ":" + ("0" + ma.getUTCSeconds()).slice(-2);
//        console.log(dateString)

        if (self.fetch) {

            try {
                const response = await fetch(url, {cache: "no-store"});
                if (response.ok) {
                    document.getElementById("gr").style.backgroundColor = "green"; 
                    P1 = await response.text();
 //                   document.getElementById(target).innerHTML = 'p1_' + dateString + '.html';

                    tmp = P1;

                    if (no_header == 1) {
//                        tmp = tmp.split('<table', 2); // split the text to title/time and the table
                        tmp = tmp.split('\r\n\r\n', 2); // split the text to title/time and the table
                        tmp = tmp[1];

                    } else {
                    
                    }
                    
//         console.log(tmp)
 
                    if (old_live != tmp) {
                        var Text = P1.split('.png">', 2); 
                        Text = Text[1].split('<img', 2); 
                        var rt = P1.split('RemainingTime">', 2); 
                        rt = rt[1].split('</span>', 2); 
                        if (no_download == 0) {
                            download(P1, dateString.replace(/:/g,"") + '_p1_' + Text[0] + '_' + rt[0] + '.html', 'text/plain');        
                        }
                        log += '<div>' + dateString + ' ' + Text[0]  + ' ' + rt[0] + nh + '</div>\n';
                        
// test web
if (no_web == 1) {

files[dateString] = P1;
localStorage.setItem('files', JSON.stringify(files));

var nn = dateString + ' ' + Text[0]  + ' ' + rt[0] + nh;

var btn = document.createElement("button");
btn.innerHTML = nn;
btn.setAttribute("onclick", "publish('" + dateString + "')");
document.getElementById("resultx").append(btn);                        
old_resultx = document.getElementById("resultx").innerHTML;
localStorage.setItem('old_resultx', old_resultx);  

} else {

}

                        old_live = tmp;
                        sessionStorage.setItem('old_live', old_live);  
                    
                    } else {
 
                        log += '<div>' + dateString + ' no update</div>\n';
                    }
                    
                } else {
                    console.log(response.status);
                    document.getElementById("gr").style.backgroundColor = "yellow"; 
                    log += '<div>' + dateString + ' server returned status: ' + response.status + '</div>\n';
                }
            }
            catch (err) {
                console.log('results fetch failed', err);
                document.getElementById("gr").style.backgroundColor = "red"; 
                log += '<div>' + dateString + ' something wrong :(</div>\n';
            }

        } 
                
        document.getElementById(target).innerHTML = log;
        localStorage.setItem('log', log);  
//        console.log(log);

        loop = function() {
            Load(url, target);
        };

// countdown
document.getElementById("gr").innerHTML = Rafraichir/1000;

        TimerLoad = setTimeout(loop, Rafraichir);
        Rafraichir = 60000;


    }

    function download(content, fileName, contentType) {
        var a = document.createElement("a");
        a.setAttribute("id", "download");
        var file = new Blob([content], {type: contentType});
        a.href = URL.createObjectURL(file);
        a.download = fileName.replace(/:/g,"_").replace(/-/g,"_").replace(/ /g,"_");
        a.click();
    };

    function clear() {
        log = "";
        old_live = "";
        document.getElementById(target).innerHTML = "";
        localStorage.removeItem('log');  
        sessionStorage.removeItem('old_live');  
    };

// test web                    
function clearWeb() {
    document.getElementById("resultx").innerHTML = "";
    document.getElementById("resultz").innerHTML = "";
    localStorage.removeItem('files');  
    localStorage.removeItem('old_resultx');  
};

function publish(x) {
    document.getElementById("resultz").innerHTML = files[x];
};

// countdown
const timer = () =>{
var x = document.getElementById("gr").innerHTML;
if (x > 0) {
    x -= 1;
} else {
    x = 0;
}
document.getElementById("gr").innerHTML = x;
}
// countdown
timer();
// Calling the function every 1000 milliseconds.
setInterval(timer,1000);


</script>



</html>
 
