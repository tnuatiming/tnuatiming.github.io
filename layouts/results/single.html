<!DOCTYPE html>
<html class="no-js" lang="he" xml:lang="he" dir="rtl">

{{ partial "head.html" . }}

    <body id="race" class="{{ with .Params.category }}{{ . }}{{ end }}">

{{ partial "header.html" . }}


{{- if (eq .Params.tag "epic") }}
    <div id="buttonInfo">
        <div id="categoryOrAll" style="display: block;">
            <button id="displayCatButton" class="btn" onClick="category('yes')">By Category</button>
            <button id="displayAllButton" class="btn" onClick="category('no')">GC</button> 
        </div>
    </div>
{{ end }}


{{- if (eq .Params.tag "Epic Israel") }}
    <h2>{{ .Params.tag }}{{ with .Params.season }} {{ . }}{{ end }}{{ with .Params.place }} - {{ . }}{{ end }}</h2>  
{{ else }}
    <h2>{{ .Params.tag }}{{ with .Params.sub }} - {{ . }}{{ end }}</h2>  
    <h2>{{ with .Params.round }}{{ . }}{{ end }}{{ if ne .Params.noseason "true" }}{{ with .Params.season }} עונת {{ . }} - {{ end }}{{ end }}{{ with .Params.place }}{{ . }} - {{ end }}{{ .Date.Format "2-1-2006" }}</h2>        
{{ end }}

{{ .Content -}}

{{$title := .Params.title}}
{{$season := .Params.season}}


{{- if (ne .Params.tag "epic") }}

    {{- if gt (len (where (where .Site.RegularPages "Params.category" .Params.category) "Params.season" .Params.season)) 1 -}}

        <div class="erlier_races"><h2>תוצאות נוספות בעונת {{ $season }}:</h2>
        <ul>

        {{ range where (where .Site.RegularPages.ByPublishDate.Reverse "Params.category" .Params.category) "Params.season" .Params.season -}}

            {{- if ne $title .Params.title -}}
                <li><a href="{{ .RelPermalink }}">{{ with .Params.round }}{{ . }} - {{ end }}{{ with .Params.place }}{{ . }} - {{ end }}{{ .Date.Format "2-1-2006" }}</a></li>
            {{ end }}
            {{- if eq $title .Params.title -}}
                <li><p>{{ with .Params.round }}{{ . }} - {{ end }}{{ with .Params.place }}{{ . }} - {{ end }}{{ .Date.Format "2-1-2006" }}</p></li>
            {{ end }}

        {{- end}}

        </ul></div>

    {{ end }}

{{ end }}

    <div id="postInfo"><p><span id="name">{{ .Params.place }}</span></p>
    <p><span id="rund">{{ .Params.round }}</span></p>

    <p><span id="date">{{ .Date.Format "20060102" }}</span></p></div>

{{ partial "footer.html" . }}

    </body>
    
{{ with (in (string .Content) "line_color") }}
    <script>    // aligning table colmuns according to number of colmuns
        var tt = document.querySelectorAll('.line_color');

        for (let kk = 0; kk < tt.length; kk++) {


    /*
            var numCols = 0;

            for (let ii = 0; ii < tt[kk].rows.length; ii++) {//loop through HTMLTableRowElement

                row = tt[kk].rows[ii];
                
                if (numCols < row.cells.length) { // find max number of colmuns
                    numCols = row.cells.length;
                }
                row = null;
            }
            var ddd = 90 / (numCols - 2); // 90% divided by number of columns - first 2 column
    */
            var tds = tt[kk].querySelectorAll('th.rnkh_font');

                if (tds.length > 15) {
                    tt[kk].classList.add("huge_table");
                } else if (tds.length > 11) {
                    tt[kk].classList.add("big_table");
                }

            var ddd = 90 / (tds.length - 2); // 90% divided by number of columns - first 2 column

            tt[kk].querySelectorAll('td.rnk_font:nth-child(n+3)').forEach(function(element) { // all from column 3
                element.style.width = ddd + "%";
            });

            tt[kk].querySelectorAll('th.rnkh_font:nth-child(n+3)').forEach(function(element) { // all from column 3
                element.style.width = ddd + "%";
            });
    //       console.log(kk + " " + numCols)
        }
    </script>
{{ end }}      
{{ with (in (string .Content) "no_num_color") }}
    <script>// find the laps tables
        var btn = document.querySelectorAll('.no_num_color');
        for (let k = 0; k < btn.length; k++) {
                // find the td in laps table and itreare them
            btn[k].querySelectorAll('td.rnk_font:not(:first-child)').forEach(e => e.addEventListener("mouseover", function() {
                    // get the value of the cell we mouseover
                var compareText = e.innerHTML;
                    // itreate all td in this table and compare
                var divs = btn[k].querySelectorAll('td.rnk_font:not(:first-child)');
                for (i = 0; i < divs.length; ++i) {
                    var text = divs[i].innerHTML;
                    // Compare this with initial text and add matching class if it matches
                    if (compareText === text && text != "") {
                        divs[i].classList.add("matching");
                        
                    }
                }
            }));
                        
/*
code for selecting color by the place of rider FIXME
  
var pl = 0;
var rows = btn[k].getElementsByTagName("tr");
  for (i = 0; i < rows.length; i++) {
    var currentRow = btn[k].rows[i];
    var createClickHandler = function(row) {
      return function() {
        var cell = row.getElementsByTagName("td")[0];
        
        if(!isNaN(parseInt(cell.innerHTML))) {
            pl = parseInt(cell.innerHTML);
        } else {
            pl = 0;

 }
        
        console.log("id:" + pl);
      };
    };
    currentRow.onmouseover = createClickHandler(currentRow);
  }
*/                        
                        
                        
                        
            btn[k].querySelectorAll('td.rnk_font:not(:first-child)').forEach(e => e.addEventListener("click", function() {
                // get the value of the cell we mouseover
                var compareText = e.innerHTML;
                    // itreate all td in this table and compare
                var divs = btn[k].querySelectorAll('td.rnk_font:not(:first-child)');
                for (i = 0; i < divs.length; ++i) {
                
                    var text = divs[i].innerHTML;
                    // Compare this with initial text and add matching class if it matches
                    if (compareText === text && text != "") {
    /*                    switch(k%3) {
                            case 0:
                                var lineColor = 'LightSkyBlue';
                                break;
                            case 1:
                                var lineColor = 'PaleGreen';
                                break;
                            case 2:
                                var lineColor = 'LightSalmon';
                                break;
                            default:
                                var lineColor = 'Lavender';
                        }
    */                
     /*               switch(Number(text)%9) {
                        case 0:
                            var lineColor = 'Beige';
                            break;
                        case 1:
                            var lineColor = 'SkyBlue';
                            break;
                        case 2:
                            var lineColor = 'Plum';
                            break;
                        case 3:
                            var lineColor = 'LightSalmon';
                            break;
                        case 4:
                            var lineColor = 'PaleGreen';
                            break;
                        case 5:
                            var lineColor = 'DarkKhaki';
                            break;
                        case 6:
                            var lineColor = 'IndianRed';
                            break;
                        case 7:
                            var lineColor = 'LemonChiffon';
                            break;
                        case 8:
                            var lineColor = 'MediumAquamarine';
                            break;
                        case 9:
                            var lineColor = 'Lavender';
                            break;
                        default:
                            var lineColor = 'Wheat';
                    }
*/
                            var lineColor = 'white';


                        divs[i].style.backgroundColor = divs[i].style.backgroundColor === lineColor.toLowerCase() ? '' : lineColor.toLowerCase();
                    } else {
                        divs[i].style.backgroundColor = '';
                    }
                }
            }));

            // on click mark number in diffrent color or delete        
    /*           btn[k].querySelectorAll('td.rnk_font:not(:first-child)').forEach(e => e.addEventListener("click", function() {
                // get the value of the cell we mouseover
                var compareText = e.innerHTML;
                    // itreate all td in this table and compare
                var divs = btn[k].querySelectorAll('td.rnk_font:not(:first-child)');
                for (i = 0; i < divs.length; ++i) {
                
                    var text = divs[i].innerHTML;
                    // Compare this with initial text and add matching class if it matches
                    if (compareText === text && text != "") {
                    switch(Number((text)%9)) {
                        case 0:
                            var lineColor = 'Beige';
                            break;
                        case 1:
                            var lineColor = 'SkyBlue';
                            break;
                        case 2:
                            var lineColor = 'Plum';
                            break;
                        case 3:
                            var lineColor = 'PaleGreen';
                            break;
                        case 4:
                            var lineColor = 'PapayaWhip';
                            break;
                        case 5:
                            var lineColor = 'DarkKhaki';
                            break;
                        case 6:
                            var lineColor = 'IndianRed';
                            break;
                        case 7:
                            var lineColor = 'LemonChiffon';
                            break;
                        case 8:
                            var lineColor = 'MediumAquamarine';
                            break;
                        case 9:
                            var lineColor = 'Lavender';
                            break;
                        default:
                            var lineColor = 'Wheat';
                    }

                        divs[i].style.backgroundColor = divs[i].style.backgroundColor === lineColor.toLowerCase() ? '' : lineColor.toLowerCase();

                    }
                }
            }));
    */         

        }
                    // clear all matching on mouseout
        document.querySelectorAll('.no_num_color td.rnk_font:not(:first-child)').forEach(e => e.addEventListener("mouseout", function() {
        
            var divs = document.querySelectorAll('.no_num_color td.rnk_font:not(:first-child)');
            for (j = 0; j < divs.length; ++j) {
        
                    divs[j].classList.remove("matching");
            }
        }));
    </script>
{{ end }}      

{{/*<!--
{{ with (in (string .Content) "line_color") }}
    <script type="text/javascript">
        {{ partial "alignTable.js" . }}
    </script>
{{ end }}      
{{ with (in (string .Content) "no_num_color") }}
    <script type="text/javascript">
        {{ partial "raceProgress.js" . }}
    </script>
{{ end }}      
-->*/}}
{{- if (eq .Params.tag "epic") }}
    <script>


        var useCategory = "yes";
        
        if (sessionStorage.getItem('categoryOrAll')) {
            useCategory = sessionStorage.getItem('categoryOrAll');
        }

        category(useCategory);
    
        function category(choice){
            
            useCategory = choice;
            
            if (useCategory == "yes") {
                sessionStorage.setItem('categoryOrAll', 'yes');
            } else if (useCategory == "no") {
                sessionStorage.setItem('categoryOrAll', 'no');
            }
            
            if (useCategory == "yes") {
                document.getElementById("displayCatButton").classList.remove("active");
                document.getElementById("displayCatButton").disabled = true;
                document.getElementById("displayAllButton").classList.add("active");        
                document.getElementById("displayAllButton").disabled = false;
            } else if (useCategory == "no") {
                document.getElementById("displayCatButton").classList.add("active");        
                document.getElementById("displayCatButton").disabled = false;
                document.getElementById("displayAllButton").classList.remove("active");        
                document.getElementById("displayAllButton").disabled = true;
            }
    
            if (useCategory == "yes") {
                document.getElementById("finalTextAll").style.display = "none";        
                document.getElementById("finalTextCategory").style.display = "block";        
            } else if (useCategory == "no") {
                document.getElementById("finalTextAll").style.display = "block";        
                document.getElementById("finalTextCategory").style.display = "none";        
            }

        }

    </script>

{{ end }}      


</html>
